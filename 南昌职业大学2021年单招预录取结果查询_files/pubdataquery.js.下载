var DATAS;var pageSize=50;var pageNo=1;var pageinfo={};var farr=[];var BARCODE_ARR=[];if(isMobile){$(FRM.FLDS).each(function(b,a){if(a.TYP=="text"&&a.BARCODE=="1"){BARCODE_ARR.push(a.FLDID)}})}function createSubField(i,l){var q="";if(l.TYP==="url"){if(i[l.NM]){q=$.format("<a class='underline' title='打开此页面' href='{0}' target='_blank'>{1}</a>",i[l.NM],i[l.NM])}else{q="&nbsp;"}}else{if(l.TYP==="money"){if(i[l.NM]){q=currencys[l.FMT]+i[l.NM]}else{q="&nbsp;"}}else{if(l.TYP==="map"){var n=i[l.SUBFLDS.TXT.NM]||"",g=i[l.SUBFLDS.J.NM],o=i[l.SUBFLDS.W.NM];var q=$.tmpl("<a class='underline location' title='在高德地图中查看' href='${mapUrl}' target='_blank'>${location}</a>",{mapUrl:$.format(mapUrlPoint,o,g),location:n});if(g&&o){}else{q=n}}else{if(l.TYP==="address"){var a=i[l.SUBFLDS.ZIP.NM]?i[l.SUBFLDS.ZIP.NM]:" ",c=i[l.SUBFLDS.PRV.NM]?i[l.SUBFLDS.PRV.NM]:" ",e=i[l.SUBFLDS.CITY.NM]?i[l.SUBFLDS.CITY.NM]:" ",k=i[l.SUBFLDS.DTL.NM]?i[l.SUBFLDS.DTL.NM]:" ";if(a||c||e||k){q=$.tmpl("<div class='location'><a class='underline' title='在高德地图中查看' href='${mapUrl}' target='_blank'>${province},${city},${zip}<span>${detail}</span></a></div>",{mapUrl:$.format(mapUrlTxt,c+" "+e+" "+a+" "+k),zip:a,province:c,city:e,detail:k})}else{q="&nbsp;"}}else{if(l.TYP==="checkbox"){$(l.ITMS).each(function(f,r){if(i[r.NM]){q=q+i[r.NM]+"<br/>"}})}else{if(l.TYP==="file"){if(i[l.SUBFLDS.ID.NM]!=null){var p=i[l.SUBFLDS.ID.NM];var b=(i[l.SUBFLDS.TYP.NM]).split(",");var d=(i[l.SUBFLDS.NM.NM]).split(",");var h="";var m=(i[l.SUBFLDS.ID.NM+"_tokens"]).split(",");$.each(p.split(","),function(j,f){if($.isImage(b[j])){var r=i.ID+"_"+l.SUBFLDS.ID.NM+b[j];h=$.format("<img src='{0}{1}?{2}'  class='img'/></br>",FILEURL,f+b[j],m[j],f+b[j],r);q+=$.format("<span class='underline big-img' url='{0}{1}?{2}'>{3}</span>",FILEURL,f+(b[j]==".nosuffix"?"":b[j]),m[j],h)}else{if($.isOfficeFile(b[j])){h=$.format("<div >{0}</div></br>",d[j]);q+=$.format("<a class='underline' target='_blank' href='{0}'>{1}</a>","https://view.officeapps.live.com/op/view.aspx?src="+encodeURIComponent(FILEURL+f+b[j]+"?"+m[j]),h)}else{if(/\.pdf$/.test(b[j])){h=$.format("<div >{0}</div></br>",d[j]);if($.isWebapp()){q+=$.format("<a class='underline' target='_blank' href='{0}'>{1}</a>","/pdf_viewer.html?file="+encodeURIComponent("https://jsformfiles.biaodan.info/"+f+b[j]+"?"+m[j]),h)}else{q+=$.format("<a class='underline' target='_blank' href='{0}{1}?{2}'>{3}</a>",FILEURL,f+b[j],m[j],h)}}else{h=$.format("<div >{0}</div></br>",d[j]);q+=$.format("<a class='underline' target='_blank' href='{0}{1}?{2}'>{3}</a>",FILEURL,f+(b[j]==".nosuffix"?"":b[j]),m[j],h)}}}})}else{q="&nbsp;"}}else{if(i[l.NM]||i[l.NM]===0){q=i[l.NM];if(l.DIGITS&&$.type(i[l.NM])==="number"){q=i[l.NM].toFixed(parseInt(l.DIGITS))}}else{q="&nbsp;"}}}}}}}q="<td>"+q+"</td>";return q}function initAuthCode(){if(SETTING.AUTH!="1"){return}var a=function(b){$("#btnSendCode").click(function(){if($(this).hasClass("disabled")){return false}var c=$("#ulFilter").find("input[ftype='phone']").val();if(!$.isMobile(c)){lang=="en"?$.alert(msg.mobileError):$.alert("请输入正确的手机号码。");return false}$("#btnSendCode2").trigger("click")});$("#btnSendCode2").click(function(){var d=b.getValidate();if(!d){lang=="en"?$.alert(msg.unVerified):$.alert("请先完成验证。");return false}var c=$("#ulFilter").find("input[ftype='phone']").val();$.ajax({url:"/web/VerifyLoginServlet",type:"post",dataType:"json",data:{geetest_challenge:d.geetest_challenge,geetest_validate:d.geetest_validate,geetest_seccode:d.geetest_seccode,TEL:c,TYP:"form",FRMID:FRM._id,SIGN:SETTING.SIGN},success:function(f){if(f&&(f.status==="success")){var g=$("#btnSendCode");g.addClass("disabled");g.text("120");var e=setInterval(function(){var h=parseInt(g.text());if(h>0){g.text(--h)}else{g.text("发送验证码");g.removeClass("disabled");clearInterval(e)}},1000);if(f.sendcount==0){lang=="en"?$.alert(msg.sendVerificationCodeError):$.alert("验证码发送失败，请稍后重试。")}else{if(f.sendcount<0){lang=="en"?$.alert(msg.noSMSError):$.alert("发送验证码失败：可用短信量不足，需要充值，请与表单创建者联系。")}else{$.alert("验证码发送成功，请注意查收。")}}return false}else{lang=="en"?$.alert(msg.ValidationFailed):$.alert("验证失败")}}});return false});b.bindOn("#btnSendCode2");b.appendTo("#popupCaptcha")};$.ajax({url:"/web/StartCaptchaServlet",type:"get",dataType:"json",success:function(b){initGeetest({gt:b.gt,challenge:b.challenge,product:"popup",offline:!b.success},a)}})}var iconmap={star:{active:"&#xe700;",normal:"&#xe6ff;"},heart:{active:"&#xe6a7;",normal:"&#xe691;"},like:{active:"&#xe7dd;",normal:"&#xe7e2;"},flower:{active:"&#xe7df;",normal:"&#xe7e1;"},fire:{active:"&#xe60d;",normal:"&#xe7e6;"},shit:{active:"&#xe7e4;",normal:"&#xe7e5;"}};function init(){if("pwd"==SETTING.PUBTYP){if(lang=="en"){$("#frmPassword label").text("Enter the password for the query");$(" #btnCheckPassword").text("confirm")}$("#frmPassword").removeClass("hide")}else{$("#container").removeClass("hide")}$.each(SETTING.FLTS,function(h,k){if(k.FLD==="WXID"){var p=$('<li><label for="FLTWXID">微信ID</label><input ftype="text" id="FLTWXID" placeholder="请在微信环境中使用" name="FLTWXID" class="filter-input ui-input-text" type="text" /></li>');$("#ulFilter").append(p);var f=$("#WXID").val();if(f){$("#FLTWXID").val(f);$("#FLTWXID").closest("li").addClass("hide")}}if(k.FLD==="EX"){var l=$('<li><label for="EX">扩展属性</label><input ftype="text" id="EX" placeholder="扩展属性" name="EX" class="filter-input ui-input-text" type="text" /></li>');$("#ulFilter").append(l)}else{if(k.FLD==="ID"){var g=$('<li><label for="ID">ID</label><input ftype="number" id="ID" name="ID" class="filter-input ui-input-text" type="number" /></li>');$("#ulFilter").append(g)}else{if(k.FLD==="CDATE"){var o;if($("#frmPassword").attr("mobile")==="1"){o=$('<li><label for="CDATE">创建日期</label><input id="CDATE" name="CDATE" type="date" class="text ui-input-text filter-input conditionValue"/></li>')}else{var j,n,e,m;if(lang=="en"){j=Date.monthNames||Date.defMonthNames,n=Date.abbrMonthNames||Date.defAbbrMonthNames,e=Date.abbrDayNames||Date.defAbbrDayNames,m=Date.dayNames||Date.defDayNames}else{j=Date.defMonthNames,n=Date.defAbbrMonthNames,e=Date.defAbbrDayNames,m=Date.defDayNames}o=$.tmpl('<li><label for="CDATE">创建日期</label><input id="CDATE" name="CDATE" type="text" class="text conditionValue"/></li>');o.find("input.conditionValue").datetimepicker({format:"Y-m-d",allowBlank:true,timepicker:false,lang:"ch"}).attr("autocomplete","off")}$("#ulFilter").append($(o))}else{$.each(FRM.FLDS,function(F,t){if(k.FLD===t.NM){if(("radio"==t.TYP||"dropdown"==t.TYP)&&t.MAT!="1"&&!t.ACMPFLD){var B=$.tmpl('<select id="${NM}" name="${NM}" class="filter-input ui-input-select"><option value=""></option></select>',t);var x=$.tmpl('<li><label for="${NM}">${LBL}</label></li>',t);$.each(t.ITMS,function(i,s){$(B).append($.tmpl('<option value="${VAL}">${VAL}</option>',s))});$(x).append($(B));$("#ulFilter").append($(x))}else{if("grade"===t.TYP){t.INPUTTYP="number";var z="";var y=t.STY;z+="<div class='block content' style='line-height: 32px'><ul><li data-default-index='0' data-sty='"+y+"' class='grade-star "+y+"'>";for(var G=1;G<=t.STL;G++){if(y!=="number"){z+='<a href="javascript:;" class="grad-item '+y+'"><i class="iconfont">'+iconmap[y]["normal"]+"</i></a>"}else{z+='<a href="javascript:;" class="grad-item '+y+'"><i class="">'+G+"</i></a>"}}z+="<input class='hide' type='text' ftype='grade'  name='"+t.NM+"' id='"+t.NM+"'></li></ul></div></li>";var v=$($.tmpl('<li><label for="${NM}">${LBL}</label>'+z,t));$("#ulFilter").append(v);v.find("a.grad-item").hover(function(L){var i=$(this).closest("li");var J=i.find("a.grad-item");var s=i.data("sty");if(s!=="number"){var K=$(this).index();J.each(function(M,N){if(M<=K){$(N).find(".iconfont").html(iconmap[s]["active"])}else{$(N).find(".iconfont").html(iconmap[s]["normal"])}})}},function(){});v.find(".block li").hover(function(i){},function(){var s=$(this).attr("data-default-index");s=parseInt(s);var i=$(this).data("sty");var J=$(this).find("a.grad-item");if(i!=="number"){J.each(function(K,L){if(K<s){$(L).find(".iconfont").html(iconmap[i]["active"])}else{$(L).find(".iconfont").html(iconmap[i]["normal"])}})}});v.find(".block li").find("a.grad-item").click(function(){var i=$(this).closest("li");var J=$(this).index()+1;var K=i.attr("data-default-index");if(J==1&&J==K){J=0}i.attr("data-default-index",J);$(this).closest("li").find("input")[0].value=J;$(this).closest("li").find("input").click();var s=i.data("sty");if(s!=="number"){i.find("a.grad-item").each(function(L,M){if(L<J){$(M).find(".iconfont").html(iconmap[s]["active"])}else{$(M).find(".iconfont").html(iconmap[s]["normal"])}})}else{if(J===0){i.find("a.grad-item").removeClass("grdactive")}else{i.find("a.grad-item").removeClass("grdactive").eq(J-1).addClass("grdactive")}}})}else{if("date"===t.TYP){var u;if($("#frmPassword").attr("mobile")==="1"){u=$.tmpl('<li><label for="${NM}">${LBL}</label><input id="${NM}" name="${NM}" type="date" class="text ui-input-text filter-input conditionValue"/></li>',t)}else{var w,q,I,C;if(lang=="en"){w=Date.monthNames||Date.defMonthNames,q=Date.abbrMonthNames||Date.defAbbrMonthNames,I=Date.abbrDayNames||Date.defAbbrDayNames,C=Date.dayNames||Date.defDayNames}else{w=Date.defMonthNames,q=Date.defAbbrMonthNames,I=Date.defAbbrDayNames,C=Date.defDayNames}u=$.tmpl('<li><label for="${NM}">${LBL}</label><input id="${NM}" name="${NM}" type="text" class="text conditionValue"/></li>',t);u.find("input.conditionValue").datetimepicker({format:"Y-m-d",allowBlank:true,timepicker:false,lang:"ch"}).attr("autocomplete","off")}$("#ulFilter").append($(u))}else{if("number"==t.TYP||"money"==t.TYP){t.INPUTTYP="number"}else{t.INPUTTYP="text"}if(t.QRINPUT=="1"&&window.wxscan==1){$("#ulFilter").append($.tmpl('<li><label for="${NM}">${LBL}</label><input ftype="${TYP}" id="${NM}" name="${NM}" class="filter-input ui-input-text" type="${INPUTTYP}" /><i class="icon-qrinput"></i></li>',t))}else{$("#ulFilter").append($.tmpl('<li><label for="${NM}">${LBL}</label><input ftype="${TYP}" id="${NM}" name="${NM}" class="filter-input ui-input-text" type="${INPUTTYP}" /></li>',t))}if(SETTING.AUTH=="1"&&t.TYP=="phone"){if(lang=="en"){$("#ulFilter").append($.tmpl('<li><label for="txtAuthCode">verification code:</label><input id="txtAuthCode" name="${NM}_AUTHCODE" class="filter-input ui-input-text" style="width:80px;" type="text" /><button type="button" id="btnSendCode" class=" btn" sign="">Send</button><button type="button" id="btnSendCode2" class="hide">send</button><div id="popupCaptcha"></div></li>',t))}else{$("#ulFilter").append($.tmpl('<li><label for="txtAuthCode">验证码:</label><input id="txtAuthCode" name="${NM}_AUTHCODE" class="filter-input ui-input-text" style="" type="text" /><button type="button" id="btnSendCode" class="sendcode btn" sign="">发送验证码</button><button type="button" id="btnSendCode2" class="hide">发送验证码</button><div id="popupCaptcha"></div></li>',t))}}}}}}else{if(k.FLD===t.FLDID){if(t.TYP=="dropdown2"){var x=$.tmpl('<li><label class="grid-label">${LBL}</label><div class="grid-container"></div></li>',t);var H=parseInt(t.pN);var E=(100/H-1).toFixed(2);for(var D=1;D<=H;D++){var r=t.SUBFLDS["DD"+D];var B=$.tmpl("<select ftype='dropdown2' class='${DDN} filter-dropdown-input ui-input-select' level='${N}' name='${NM}'><option value=''></option></select>",{DDN:"dd"+D,N:D,NM:r.NM});if(!$.isWebapp()){B.css({width:E+"%"})}x.find("div.grid-container").append(B)}var B=x.find("select.dd1");var A=t.ITMS||[];$.each(A,function(i,s){B.append($.format("<option items='{0}' value='{1}'>{1}</option>",JSON.stringify(s.ITMS),s.VAL))});$("#ulFilter").append($(x));initDropdown2(t,x)}else{if(t.TYP=="checkbox"){var x=$.tmpl('<li><label class="grid-label">${LBL}</label><div class="grid-container"></div></li>',t);var A=t.ITMS||[];$.each(A,function(i,J){if(J.OTHER=="1"){return}var K=t.FLDID+i;var s=$.tmpl('<span><div class="pretty-box"><input ftype="checkbox" type="checkbox" value="${VAL}" name="${NM}" id="'+K+'"><label for="'+K+'"> ${VAL}</label></div></span>',J);x.find("div.grid-container").append(s)});$("#ulFilter").append($(x))}}}}})}}}});if(SETTING.FLTS.length>0){if(lang=="en"){$("#ulFilter").append('<li class="search-btn-li"><span id="search-span"><a id="btnQuery" class="btn blue" style="margin-left: 0px;">Search</a></span></li>')}else{$("#ulFilter").append('<li class="search-btn-li"><span id="search-span"><a id="btnQuery" class="btn blue" style="margin-left: 0px;">查询</a></span></li>')}}else{lang=="en"?$("#info").text(msg.noQueryCondition).show():$("#info").text("没有设置查询条件，不能查询数据，请与表单发布者联系。").show()}if(window.QPARAMS){for(var c in window.QPARAMS){window.QPARAMS[c]=decodeURIComponent(window.QPARAMS[c])}$("#ulFilter").setValues(window.QPARAMS,true,true)}else{var d=localStorage.getItem(SETTING.SHORTID);if(d){d=JSON.parse(d);delete d.WXID;if($("#FLTWXID").val()){d.FLTWXID=$("#FLTWXID").val()}for(var c in d){if(/_AUTHCODE$/.test(c)){d[c]=""}}$("#ulFilter").setValues(d,true,true);if($("#ulFilter").find("select.dd2").length>0){$("#ulFilter").find("select.dd1").trigger("change");$("#ulFilter").setValues(d,true,true)}if($("#ulFilter").find("select.dd3").length>0){$("#ulFilter").find("select.dd2").trigger("change");$("#ulFilter").setValues(d,true,true)}if($("#ulFilter").find("select.dd4").length>0){$("#ulFilter").find("select.dd3").trigger("change");$("#ulFilter").setValues(d,true,true)}var a=$("#ulFilter").find("input[ftype=grade]");if(a.length){$.each(a,function(e,f){$.setGrade($(f).closest("ul"),$(f).val())})}}}var b="<img src='/rs/images/nomessagen.png' alt=''><span style='display:block;margin-top:8px;color: #828999;'>暂无数据，请在上方设置查询条件后点击查询</span>";$("#init").html(b)}function getFldParam(d){var c=[];var a=false;var b=d.FLDS;c.push({name:"ID",value:"ID",dtype:"number"});$.each(b,function(g,h){if(h.TYP=="checkbox"){h.ITMS.forEach(function(f){c.push({name:f.VAL,value:f.NM,dtype:"string"})})}else{if(h.TYP=="goods"){a=true}else{if(h.TYP=="address"){c.push({name:"省/自治区/直辖市",value:h.SUBFLDS.PRV.NM,dtype:"string"});c.push({name:"市",value:h.SUBFLDS.CITY.NM,dtype:"string"});c.push({name:"区/县",value:h.SUBFLDS.ZIP.NM,dtype:"string"});c.push({name:"详细地址",value:h.SUBFLDS.DTL.NM,dtype:"string"})}else{if(h.TYP=="dropdown2"){var l=1;for(var k in h.SUBFLDS){var j={name:h.LBL+"("+(l++)+")",value:h.SUBFLDS[k].NM,dtype:"string"};c.push(j)}}else{if(h.TYP=="map"){c.push({name:h.LBL,value:h.SUBFLDS.TXT.NM,dtype:"string"})}else{if(h.TYP=="file"){c.push({name:"文件类型",value:h.SUBFLDS.TYP.NM,dtype:"string"});c.push({name:"文件大小",value:h.SUBFLDS.SZ.NM,dtype:"number"});c.push({name:"文件名称",value:h.SUBFLDS.NM.NM,dtype:"string"})}else{if(h.TYP=="likert"){h.ITMS.forEach(function(f){var i={name:f.LBL,value:f.NM,dtype:"string"};c.push(i)})}else{if(h.TYP=="table"){}else{if(h.TYP=="radio"){c.push({name:h.LBL,value:h.NM,dtype:"string"})}else{if(h.TYP=="dropdown"){c.push({name:h.LBL,value:h.NM,dtype:"string"})}else{if(h.NM){var e={name:h.LBL,value:h.NM,dtype:"string"};if(h.TYP=="date"){e.dtype="date"}c.push(e)}}}}}}}}}}}});if(a){c.push({name:"金额",value:"AMT",dtype:"number"});c.push({name:"在线支付状态",value:"PAYSTATUS",dtype:"string"});c.push({name:"支付时间",value:"PAYEDTIME",dtype:"date"});c.push({name:"交易流水号",value:"TRADEID",dtype:"string"})}if("1"==d.VERIFY){c.push({name:"核销状态",value:"VERIFYSTATUS",dtype:"string"});c.push({name:"核销码",value:"VERIFYID",dtype:"string"});c.push({name:"核销过期日期",value:"VERIFYEXPDATE",dtype:"date"})}if("1"==d.EX){c.push({name:"扩展属性",value:"EX",dtype:"string"})}if("1"==d.COUPON){c.push({name:"优惠码",value:"COUPONCODE",dtype:"string"})}return c}function dataQuery(a){switch(a){case"FIRST":pageNo=1;break;case"PRE":pageNo=pageNo-1;break;case"NEXT":pageNo=pageNo+1;break;default:pageNo=1}$("#entries").empty();var b={};$("#formFilter").find("input,select").each(function(f,j){var g=$(j),d=g.attr("ftype");var h=["geetest_challenge","geetest_validate","geetest_seccode"];if("number"==d||"money"==d||"grade"==d){b[g.attr("name")]=parseFloat(g.val())}else{if(g.attr("type")=="checkbox"){if(g.prop("checked")){b[g.attr("name")]=g.val()}}else{var e=false;for(var c=0;c<h.length;c++){if(g.attr("name")===h[c]){e=true;break}}if(!e){b[g.attr("name")]=g.val()}}}});if(lang=="en"){$.showStatus(msg.querying);$("#alertBox .title").text("prompt");$("#alertBox .btnconfirm").text("confirm");b.lang="en"}else{$.showStatus("正在查询...")}b.SHORTID=SETTING.SHORTID;if(b.FLTWXID){b.WXID=b.FLTWXID;delete b.FLTWXID}localStorage.setItem(b.SHORTID,JSON.stringify2(b));b.PREORNEXT=a;b.PAGEINFO=pageinfo;$.postJSON("/web/pubdata/query",b,function(c){$.hideStatus();if(c.errmsg){$.alert(c.errmsg);$("#pagination").addClass("hide");$("#recomend-diypage").addClass("fixed");pageNo=1;return}if(c.total<=0){var d="没有查询到结果，请确认所填信息正确。";if(SETTING.NODATADESC){d=SETTING.NODATADESC}d="<img src='/rs/images/nomessagen.png' alt=''><span class='noddatatext' style='display:block;margin-top:8px;color: #828999;'>"+d+"</span>";if(lang=="en"){$("#info").text(msg.queyResult).removeClass("hide")}else{$("#info").html(d).removeClass("hide")}$("#pagination").addClass("hide");$("#recomend-diypage").addClass("fixed");$("#init").addClass("hide");pageNo=1;return}$("#init").addClass("hide");$("#info").text("").addClass("hide");DATAS=c.rows;var e=Math.floor((c.total+pageSize-1)/pageSize);if(e>1){$("#pagination").removeClass("hide");$("#recomend-diypage").removeClass("fixed");$("#recomend-diypage").removeClass("fixed");if(pageNo<=1){$("#pagination").find(".prepage,.split").addClass("hide").end().find(".nextpage").removeClass("hide")}else{if(pageNo>1&&pageNo<e){$("#pagination").find(".pbtn,.split").removeClass("hide")}else{if(pageNo>=e){$("#pagination").find(".nextpage,.split").addClass("hide").end().find(".prepage").removeClass("hide")}}}}else{$("#pagination").addClass("hide");$("#recomend-diypage").addClass("fixed")}if(c.rows.length>0){if(SETTING.SORTFLD){$.each(farr,function(g,j){if(SETTING.SORTFLD==j.value){var k={};var h={};k[j.value]={};h[j.value]={};k[j.value]["val"]=c.rows[0][j.value];k[j.value]["dtype"]=j.dtype||"string";h[j.value]["val"]=c.rows[c.rows.length-1][j.value];h[j.value]["dtype"]=j.dtype||"string";if(j.dtype==="date"){k[j.value]["val"]=c.rows[0][j.value+"_SRC"];h[j.value]["val"]=c.rows[c.rows.length-1][j.value+"_SRC"]}k._id=c.rows[0]._id;h._id=c.rows[c.rows.length-1]._id;pageinfo={FIRST:k,LAST:h};return false}})}else{pageinfo={FIRST:{_id:c.rows[0]._id,UPTIME:{val:c.rows[0].UPTIME_SRC,dtype:"date"}},LAST:{_id:c.rows[c.rows.length-1]._id,UPTIME:{val:c.rows[c.rows.length-1].UPTIME_SRC,dtype:"date"}}}}}$.each(c.rows,function(j,n){var f=$("<li class='view-result'></li>");if(c.rows.length==1&&n.URL){var k=$.format("<iframe id='{0}' src='{1}' style='width:100%;height:650px;border:0px;'></iframe>",n._id,"https://view.officeapps.live.com/op/view.aspx?src="+encodeURIComponent(n.URL+"&t="+new Date().getTime()));f.append(k)}else{var g=$('<div id="li'+n._id+'" class="result-table-wrap"></div>');g.append($.format('<div class="li-split"><span class="num">#{0}</span>{1}<span>&nbsp;</span><div class="btns"></div></div>',(j+1),(n.WXID&&$("#WXID").val()==n.WXID)?$.format('<a href="/web/entryedit/{0}?SHORTID={1}" class="iconfont right edit hide">&#xe70c;</a>',n._id,SETTING.SHORTID):""));if(c.rows.length==1){g.find("div.li-split").find("span.num").addClass("hide")}if(!$.isWebapp()&&"1"===SETTING.QPRINT){g.find("div.li-split div.btns").append($.format('<div class="clearfix pub-btn"><a href="javascript:;" data-id="{0}" class="print"><i class="iconfont">&#xe743;</i>打印</a></div>',n._id))}if("1"===SETTING.QDOWNLOAD&&SETTING.WORDTEPS.length>0&&HASWORDPRINT){if(!$.isWebapp()){g.find("div.li-split div.btns").append($.format('<div class="clearfix pub-btn"><a href="javascript:;" data-id="{0}" class="downloadword"><i class="iconfont">&#xe6a8;</i>下载</a></div>',n._id))}else{var m=FRM._id;var h=SETTING.SHORTID;var l="/web/pubdata/viewword/"+n._id+".docx?FRMID="+m+"&SHORTID="+h;g.find("div.li-split div.btns").append($.format('<div class="clearfix pub-btn"><a href="{0}" class="download"><i class="iconfont">&#xe6a8;</i>下载</a></div>',l))}}if((c.rows.length==1&&n.WXID&&$("#WXID").val()==n.WXID&&HASWXPUBEDIT&&SETTING.EDIT=="1")||(SETTING.EDIT=="2"&&SETTING.AUTH=="1")||(SETTING.EDIT=="3")){g.find("div.li-split div.btns").append($.format('<div class="clearfix pub-btn"><a href="/web/entryedit/{0}?SHORTID={1}" class="edit"><i class="iconfont">&#xe71d;</i>修改</a></div>',n._id,SETTING.SHORTID))}g.append($("#viewView").find("table.viewtable").clone());g.entrydata();g.entrydata("view",{data:n,form:FRM,showAllFld:SETTING.ALLFLDS,showFields:SETTING.FLDS,links:SETTING.LINKS,desentive:SETTING.DESENTIVE,isPubQuery:true,isMobile:isMobile});f.append(g);if(SETTING.HIDENULL==="1"){g.find("table.viewtable>tbody>tr").each(function(i,p){var o=$(p).find(">td").html();if(!o||o=="&nbsp;"){$(p).addClass("hide")}})}}$("#entries").append(f)});if(isMobile){BARCODE_ARR.forEach(function(f){$("[id=td"+f+"]").each(function(g,h){if($(this).html()!=null&&$(this).html()!=""&&/^[0-9]+$/.test($(this).html())){$(this).html($.format("<span class='spanText qrcode2-box'><a href='/web/barcode/{0}/{1}' class='code'><img class='grid-img' src='/qrcode.jpg?type=verify&verifyid={1}'></a><br><span class='qrcode2-num'>{1}</span></span>",FRM._id,$(this).html()))}})})}if((window.ISWEIXIN&&HASWXPUBEDIT&&SETTING.EDIT=="1")||(SETTING.EDIT=="2"&&"1"==SETTING.AUTH)||(SETTING.EDIT=="3")){$("#entries").find("a.edit").removeClass("hide")}})}function initAction(){$("#btnQuery").click(function(){dataQuery("FIRST")});$("#pagination").on("click",".prepage",function(){dataQuery("PRE")});$("#pagination").on("click",".nextpage",function(){dataQuery("NEXT")});$("#entries").on("click",".table-tr .subdata-header",function(){var a=$(this).closest(".sub-table-data-warp");if(a.hasClass("row-close")){a.removeClass("row-close").addClass("row-open");a.find(".opera .toogle-text").text("收起")}else{if(a.hasClass("row-open")){a.removeClass("row-open").addClass("row-close");a.find(".opera .toogle-text").text("展开")}}});$("#entries").on("click",".table-tr .table-fld-warp",function(){var a=$(this).closest(".table-tr");if(a.hasClass("table-close")){a.removeClass("table-close").addClass("table-open");a.find(".table-fld-warp .opera .toogle-text").text("收起")}else{if(a.hasClass("table-open")){a.removeClass("table-open").addClass("table-close");a.find(".table-fld-warp .opera .toogle-text").text("展开")}}});if(window.QPARAMS){$("#btnQuery").trigger("click");$("#formFilter").addClass("hide")}if(SETTING.FLTS.length===1){if(SETTING.FLTS[0]["FLD"]==="WXID"&&$("#WXID").val()){$("#btnQuery").trigger("click");$("#formFilter").addClass("hide")}}$("#btnCheckPassword").click(function(){var a=$("#frmPassword").getValues();lang=="en"?$.showStatus(msg.verifyingPassword):$.showStatus("正在验证密码...");a.SHORTID=SETTING.SHORTID;$.postJSON("/web/pubdata/checkpwd",a,function(b){$.hideStatus();if(b.status=="success"){$("#frmPassword").addClass("hide");$("#container").removeClass("hide")}else{if(lang=="en"){$.alert(msg.wrongPassword);$("#alertBox .title").text("prompt");$("#alertBox .btnconfirm").text("confirm")}else{$.alert("密码错误，请重新输入。")}}});return false});$("#frmPassword").submit(function(){$("#btnCheckPassword").trigger("click");return false});initPrint()}function initDropdown2(c,a){var b=parseInt(c.pN);for(var d=1;d<b;d++){a.find("select.dd"+d).bind({change:function(){var g=$(this).find("option:selected").attr("items");var h=[];if(g){h=JSON.parse(g)}else{h.push({VAL:""})}var f=parseInt($(this).attr("level"));var e=$(this).parent().find("select.dd"+(f+1));e.empty();$.each(h,function(j,k){if(k.ITMS){e.append($.format("<option items='{0}' value='{1}'>{1}</option>",JSON.stringify(k.ITMS),k.VAL))}else{e.append($.format("<option value='{0}'>{0}</option>",k.VAL))}});e.trigger("change")}}).trigger("change")}}function initPrint(){$("a.print").live("click",function(){var f=$(this).data("id");var e={};$.each(DATAS,function(g,h){if(h._id==f){e=JSON.parse(JSON.stringify(h));return false}});var d=b(e);if(!d){return false}d.EDIT=false;var c=JSON.stringify(d);var e={data:c};a(PRINTHOST+"/web/print",e,"post")});$("#container").on("click","a.downloadword",function(){var e=$(this).data("id");var d=FRM._id;var c=SETTING.SHORTID;$.download("/web/pubdata/exportword",{ENTRYID:e,FRMID:d,SHORTID:c},"post")});function a(e,g,h){if(e&&g){var c="",d,f=$("<form />").attr("action",e).attr("method",(h||"post"));f.attr("target","_blank");$.each(g,function(j,i){d=$("<input type='hidden' />");d.attr("name",j).attr("value",i);f.append(d)});f.appendTo("body").submit().remove()}}function b(g){var i=false;var h=[];$.each(FRM.FLDS,function(k,j){if(SETTING.ALLFLDS=="1"){h.push(j)}else{$.each(SETTING.FLDS,function(m,l){if(j.FLDID==l){h.push(j);return false}})}});$(h).each(function(u,k){var v;var l;if(k.TYP==="goods"){i=true;v="";$(k.ITMS).each(function(G,L){l=L.NM;var C=L.GGXH;if(g[l]){var K=L.VAL;var E=L.PRC||0;if(C){var H=C.LVL;var J={};var F;for(var D=1;D<=H;D++){var n=C["DD"+D]["NM"];if(g[n]){K+="("+g[n]+")";J["DD"+D]=g[n]}}var I=C.DTL||[];$.each(I,function(Q,P){var N=true;for(var O=1;O<=H;O++){if(P["DD"+O]!=P["DD"+O]){N=false;break}}if(N){F=P;return false}});if(F&&F.PRC){E=F.PRC}}var M=L.CNY||"￥";v+=K+":"+M+E+" × "+g[l]+";"}});if(v){g[l]=v}else{g[l]=""}k.NM=l}else{if(k.TYP==="number"){var o=g[k.NM];if(typeof o==="number"){if(k.DIGITS){g[k.NM]=o.toFixed(parseInt(k.DIGITS))}else{g[k.NM]=""+o}}}else{if(k.TYP==="address"){l=k.SUBFLDS.PRV.NM;v="";if(g[k.SUBFLDS.PRV.NM]){v+=g[k.SUBFLDS.PRV.NM]}if(g[k.SUBFLDS.CITY.NM]){v+=g[k.SUBFLDS.CITY.NM]}if(g[k.SUBFLDS.ZIP.NM]){v+=g[k.SUBFLDS.ZIP.NM]}if(g[k.SUBFLDS.DTL.NM]){v+=g[k.SUBFLDS.DTL.NM]}g[l]=v;k.NM=l}else{if(k.TYP==="map"){l=k.SUBFLDS.TXT.NM;k.NM=l}else{if(k.TYP==="file"){l=k.SUBFLDS.ID.NM;if(g[l]){var y=g[l].split(",");var m=[];var A=g[k.SUBFLDS.TYP.NM].split(",");var s=(g[k.SUBFLDS.ID.NM+"_tokens"]||"").split(",");var x=g[k.SUBFLDS.NM.NM].split(",");$(y).each(function(n,D){var C=/\.(jpeg|jpg|gif|bmp|png|JPEG|JPG|GIF|BMP|PNG)/;if(C.test(A[n])){m.push(D+A[n]+"?"+s[n])}else{m.push(x[n])}});g[l]=m.toString()}else{g[l]=""}k.NM=l}else{if(k.TYP==="checkbox"){v="";$(k.ITMS).each(function(n,C){l=C.NM;if(g[C.NM]&&n==k.ITMS.length-1){v+=g[C.NM]}else{if(g[C.NM]){v+=g[C.NM]+","}}});k.NM=l;if(v){g[l]=v}else{g[l]=""}}else{if(k.TYP==="likert"){$(k.ITMS).each(function(n,C){var D={};D.NM=C.NM;D.TYP="string";D.LBL=C.LBL;h.push(D)})}else{if(k.TYP==="date"){var t=g[k.NM];if(t&&k.DFMT&&k.DFMT!=="ymd"){var j=t.split("-");var z="";if(k.DFMT==="mdy"){z=$.format("{0}/{1}/{2}",j[1],j[2],j[0])}else{if(k.DFMT==="dmy"){z=$.format("{0}/{1}/{2}",j[2],j[1],j[0])}else{if(k.DFMT==="ymdc"){z=$.format("{0}年{1}月{2}日",j[0],j[1],j[2])}}}g[k.NM]=z}}else{if(k.TYP==="table"){var p=g[k.NM];var B=k.SUBFLDS;var w="";$(p).each(function(n,C){$(B).each(function(E,M){if(M.TYP==="checkbox"){var I=M.ITMS;var N="";$(I).each(function(Q,R){w=R.NM;if(C[w]){N+=C[w]+"\n"}});M.NM=w;if(N){C[w]=N}else{C[w]=""}}else{if(M.TYP==="number"){if(M.DIGITS){var F=C[M.NM];if($.type(F)==="number"){C[M.NM]=F.toFixed(parseInt(M.DIGITS))}}}else{if(M.TYP==="file"){w=M.SUBFLDS.ID.NM;if(C[w]){var D=C[w].split(",");var L=[];var H=C[M.SUBFLDS.TYP.NM].split(",");var J=(C[M.SUBFLDS.ID.NM+"_tokens"]||"").split(",");var G=C[M.SUBFLDS.NM.NM].split(",");$(D).each(function(Q,S){var R=/\.(jpeg|jpg|gif|bmp|png|JPEG|JPG|GIF|BMP|PNG)/;if(R.test(H[Q])){L.push(S+H[Q]+"?"+J[Q])}else{L.push(G[Q])}});C[w]=L.toString()}else{C[w]=""}M.NM=w}else{if(M.TYP==="date"){w=M.NM;if(M.DFMT&&M.DFMT!=="ymd"){var O=C[w];if(O){var P=O.split("-");var K="";if(M.DFMT==="mdy"){K=$.format("{0}/{1}/{2}",P[1],P[2],P[0])}else{if(M.DFMT==="dmy"){K=$.format("{0}/{1}/{2}",P[2],P[1],P[0])}else{if(M.DFMT==="ymdc"){K=$.format("{0}年{1}月{2}日",P[0],P[1],P[2])}}}C[w]=K}}}}}}})})}else{if(k.TYP==="name"){var q=g[k.NM]||"";if(/\.(jpeg|jpg|gif|bmp|png|JPEG|JPG|GIF|BMP|PNG)/.test(q)){g[k.NM]=q+"?"+(g[k.NM+"_tokens"]||"")}}else{if(k.TYP==="users"||k.TYP==="groups"){var r="";if(g[k.NM+"_objs"]){g[k.NM+"_objs"].forEach(function(C){var n=C.name||"";if(r){r+=(";"+n)}else{r=n}});g[k.NM]=r}}}}}}}}}}}}});var c=[];var f={ID:"数据ID",AMT:"金额",TRADEID:"交易流水号",PAYSTATUS:"在线支付状态",PAYEDTIME:"支付时间",VERIFYSTATUS:"核销状态",VERIFYID:"核销码",VERIFYDATE:"核销日期",VERIFYEXPDATE:"核销过期日期",VERIFYBY:"核销人",STAR:"星标",PROCESSED:"已处理"};if(SETTING.ALLFLDS==="1"||$.inArray("ID",SETTING.FLDS)>=0){c.push("ID")}if(SETTING.ALLFLDS=="1"){if(g.STAR=="1"){g.STAR="是"}else{g.STAR="否"}if(g.PROCESSED=="1"){g.PROCESSED="是"}else{g.PROCESSED="否"}c.push("STAR");c.push("PROCESSED")}else{delete g.STAR;delete g.PROCESSED}if(FRM.VERIFY==="1"){var e=(SETTING.ALLFLDS=="1");if(!e){$.each(SETTING.FLDS,function(k,j){if(j=="VERIFYSTATUS"){e=true;return false}})}if(e){c.push("VERIFYID");c.push("VERIFYSTATUS");c.push("VERIFYDATE");c.push("VERIFYEXPDATE");c.push("VERIFYBY");if(g.VERIFYSTATUS=="1"){g.VERIFYSTATUS="已核销"}else{if(g.VERIFYSTATUS=="2"){g.VERIFYSTATUS="部分核销"}else{g.VERIFYSTATUS="未核销"}}}}if(i){if(SETTING.ALLFLDS==="1"||$.inArray("AMT",SETTING.FLDS)>=0){c.push("AMT")}if(SETTING.ALLFLDS==="1"||$.inArray("PAYSTATUS",SETTING.FLDS)>=0){c.push("PAYSTATUS")}if(SETTING.ALLFLDS==="1"||$.inArray("PAYEDTIME",SETTING.FLDS)>=0){c.push("PAYEDTIME")}if(SETTING.ALLFLDS==="1"||$.inArray("TRADEID",SETTING.FLDS)>=0){c.push("TRADEID")}if(!g.PAYSTATUS){g.PAYSTATUS="未支付"}}$(c).each(function(k,j){var l={};l.NM=j;l.TYP="string";l.LBL=f[j];if(j==="AMT"){l.TYP="number"}h.push(l)});var d={FLDS:h,ENTRY:[g],FRMNM:FRM.FRMNM,FORMID:FRM._id,SID:FRM.SID,APPNAME:"jsform",IMAGEURL:IMAGEURL,FILEURL:FILEURL};return d}}var event="click";if(isMobile){event="touchstart"}$("#entries").on("click",".pub-btn .edit",function(a){if($.getUrlParam("viewAppSid")){$.openGlobalNotice("模板仅支持预览","error");a.preventDefault();return false}});$("#entries").on(event,".viewtable .sign #sign-contract",function(){if($.getUrlParam("viewAppSid")){$.openGlobalNotice("模板仅支持预览","error");return false}var a=$(this).data("id");$.postJSON("/web/contract/getSignUrl/"+a,{},function(b){if(b.data){var c=[];Object.keys(b.data).map(function(d){if("sponShortUrl"!=d&&"sponUrl"!=d){c.push({name:d,value:b.data[d],})}});if(!isMobile){signContractForPc(c)}else{signContractForMobile(c)}}else{if(isMobile){$.showStatusforMobile(b.message);return}$.showStatus(b.message+"。",true);$.hideStatus()}})});$("#entries").on(event,".viewtable td #download-contract",function(){var a=$(this).data("id");$.postJSON("/web/contract/getFileUrl/"+a,{},function(b){if(b.data){if(!isMobile){$("#downloadUrl").val(b.data);$.lightBox({url:"#download-contract-lightbox",title:"下载合同",showclose:"1",cache:"1",confirm:function(){},cancel:function(){}})}else{window.location.href="/pdf_viewer.html?file="+encodeURIComponent(b.data)}}else{if(isMobile){$.showStatusforMobile(b.message);return}$.showStatus(b.message+"。",true);$.hideStatus()}})});function signContractForPc(c){var a="";c.map(function(e){var d='<div class="signers"><div style="position: relative;margin-bottom: 8px;"><div class="title">'+e.name+'：</div><input id="url-copy" value='+e.value+' type="text" style="position: absolute;top:39px;z-index: -1;height: 0;left:6px" /><input id="url" class="url signUrl" value='+e.value+' type="text" disabled /><a href="javascript:;" class="sign-copy button" data-signerurl='+e.value+'>复制</a><a href="javascript:;" class="sign-open button" data-signerurl='+e.value+">打开</a></div></div>";a+=d});$("#sign-contract-lightbox").html(a);$.lightBox({url:"#sign-contract-lightbox",title:"签署合同",showclose:"1",cache:"0",confirm:function(){},cancel:function(){$.closeLightBox()}});var b=$(".sign-copy");if(b&&a.length>0){b.each(function(g,f){var e=$(this).attr("data-signerurl");$(this).on(event,function(){var j=$(this).parent().children("#url-copy");j.select();var i=j.val();var h=document.execCommand("Copy",false,null);if(h==true){$.showStatus("复制成功"+i+"。",true)}else{$.showStatus("当前浏览器不支持复制，请手动复制。",true)}$.hideStatus()});var d=$(this).parent().children(".sign-open");d.on(event,function(){window.open(e,"_blank")})})}}function signContractForMobile(c){if(c.length>0){var d="";c.map(function(e){d+='<div class="sign-name part" data-signerurl='+e.value+">"+e.name+"</div>"});var a='<div class="sign-contract-lightbox-m">\n        <div class="title part">请选择签署人身份</div>'+d+'\n        <div class="closebtn part">关闭</div>\n    </div>';$("#sign-contract-lightbox-mask").html(a);$("#sign-contract-lightbox-mask").css("display","block");$(".closebtn").on(event,function(){$("#sign-contract-lightbox-mask").css("display","none")});var b=$(".sign-name.part");if(b&&b.length>0){b.each(function(){$(this).on(event,function(){var e=$(this).attr("data-signerurl");window.location.href=e})})}}}$(".contract-download").on(event,function(){window.open($("#downloadUrl").val(),"_blank")});$("#btnCancel").on(event,function(){$("#overlay").addClass("hide");$("#lightBox").addClass("hide")});$("#btnCanceldownload").on(event,function(){$("#overlay").addClass("hide");$("#lightBox").addClass("hide")});head.ready(function(){init();initAction();initAuthCode();farr=getFldParam(FRM)});